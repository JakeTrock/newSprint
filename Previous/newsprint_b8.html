<!DOCTYPE html>
<html>

<body>

    <button onclick="spr()">Try it</button>
    <div class="sprFocus"></div>
    <p class="sprtxt">lorem ipsum</p>
    <p class="sprtxt">lorem ipsum</p>
    <p class="sprtxt">lorem ipsum</p>
    <p class="sprtxt">lorem ipsum</p>
    <a href="https://google.com" class="sprtxt">lorem ipsum</a>
    <p class="sprtxt">lorem ipsum</p>
    <p class="sprtxt">lorem ipsum</p>
    <p class="sprtxt">lorem ipsum</p>
    <!-- <p class="sprtxt">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
        labore et dolore magna aliqua. Pellentesque pulvinar pellentesque habitant morbi tristique senectus et netus et.
        Semper risus in hendrerit gravida rutrum quisque non. Suspendisse in est ante in nibh mauris. Gravida arcu ac
        tortor dignissim convallis aenean. Velit euismod in pellentesque massa. Justo eget magna fermentum iaculis eu
        non. Duis at consectetur lorem donec massa sapien. Eget magna fermentum iaculis eu non diam. Volutpat commodo
        sed egestas egestas fringilla phasellus faucibus. Interdum velit laoreet id donec ultrices tincidunt arcu.
        Pulvinar elementum integer enim neque volutpat ac tincidunt vitae semper. Et egestas quis ipsum suspendisse
        ultrices gravida. Elit at imperdiet dui accumsan sit amet nulla. Ut aliquam purus sit amet luctus venenatis
        lectus magna. Non consectetur a erat nam at lectus urna duis. Faucibus ornare suspendisse sed nisi lacus sed
        viverra tellus. Venenatis tellus in metus vulputate eu scelerisque felis imperdiet. Ornare aenean euismod
        elementum nisi quis eleifend.

        Sed turpis tincidunt id aliquet risus feugiat in ante. Eget nunc scelerisque viverra mauris in aliquam sem
        fringilla ut. Amet massa vitae tortor condimentum lacinia quis vel eros donec. At tempor commodo ullamcorper a
        lacus vestibulum. Curabitur gravida arcu ac tortor dignissim. Eget mauris pharetra et ultrices. Vitae purus
        faucibus ornare suspendisse sed nisi lacus sed. At elementum eu facilisis sed odio morbi quis commodo. Sed arcu
        non odio euismod lacinia at. Orci a scelerisque purus semper. Egestas sed sed risus pretium quam vulputate
        dignissim. Id venenatis a condimentum vitae sapien pellentesque habitant morbi tristique. Vestibulum lorem sed
        risus ultricies tristique nulla aliquet. Fermentum leo vel orci porta non pulvinar neque. Magna etiam tempor
        orci eu lobortis elementum nibh tellus. Dui faucibus in ornare quam viverra orci sagittis. Porttitor leo a diam
        sollicitudin tempor id eu nisl nunc. Elit pellentesque habitant morbi tristique.

        Nec dui nunc mattis enim ut tellus elementum. Nascetur ridiculus mus mauris vitae ultricies leo integer
        malesuada. Amet porttitor eget dolor morbi non. Viverra mauris in aliquam sem fringilla ut. Sollicitudin ac orci
        phasellus egestas tellus rutrum tellus. Ipsum suspendisse ultrices gravida dictum fusce ut placerat orci. Nulla
        facilisi nullam vehicula ipsum. Magna fringilla urna porttitor rhoncus dolor. Blandit turpis cursus in hac
        habitasse platea dictumst quisque. Sed arcu non odio euismod lacinia at quis. Ornare arcu dui vivamus arcu felis
        bibendum ut tristique. Imperdiet nulla malesuada pellentesque elit. Eget lorem dolor sed viverra. Massa enim nec
        dui nunc. Condimentum id venenatis a condimentum vitae sapien.

        Ut enim blandit volutpat maecenas volutpat blandit aliquam. Orci eu lobortis elementum nibh tellus molestie.
        Vestibulum sed arcu non odio euismod lacinia at quis. Ut diam quam nulla porttitor. Morbi tristique senectus et
        netus. Justo donec enim diam vulputate ut. Fusce ut placerat orci nulla pellentesque dignissim enim. Eget est
        lorem ipsum dolor sit amet consectetur adipiscing. Ut porttitor leo a diam sollicitudin tempor id eu nisl.
        Egestas maecenas pharetra convallis posuere morbi leo urna molestie. Volutpat ac tincidunt vitae semper quis.
        Massa tincidunt dui ut ornare lectus sit amet est. Nam at lectus urna duis convallis. Ornare massa eget egestas
        purus viverra accumsan in nisl. Sit amet nulla facilisi morbi. Elit pellentesque habitant morbi tristique
        senectus et netus. Duis tristique sollicitudin nibh sit amet commodo. Sed arcu non odio euismod lacinia.

        Dignissim suspendisse in est ante in nibh. Gravida quis blandit turpis cursus in. Feugiat sed lectus vestibulum
        mattis ullamcorper velit sed. Adipiscing elit pellentesque habitant morbi tristique senectus et netus et. Vitae
        sapien pellentesque habitant morbi tristique senectus. Turpis massa tincidunt dui ut ornare. Nunc lobortis
        mattis aliquam faucibus. Sollicitudin ac orci phasellus egestas tellus. Aliquet nec ullamcorper sit amet risus
        nullam eget felis. Ornare quam viverra orci sagittis. Pellentesque habitant morbi tristique senectus et netus et
        malesuada fames. Tortor aliquam nulla facilisi cras fermentum odio eu feugiat. Lacus viverra vitae congue eu
        consequat ac felis donec et. Ipsum consequat nisl vel pretium.</p>
    <p class="sprtxt">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
        labore et dolore magna aliqua. Pellentesque pulvinar pellentesque habitant morbi tristique senectus et netus et.
        Semper risus in hendrerit gravida rutrum quisque non. Suspendisse in est ante in nibh mauris. Gravida arcu ac
        tortor dignissim convallis aenean. Velit euismod in pellentesque massa. Justo eget magna fermentum iaculis eu
        non. Duis at consectetur lorem donec massa sapien. Eget magna fermentum iaculis eu non diam. Volutpat commodo
        sed egestas egestas fringilla phasellus faucibus. Interdum velit laoreet id donec ultrices tincidunt arcu.
        Pulvinar elementum integer enim neque volutpat ac tincidunt vitae semper. Et egestas quis ipsum suspendisse
        ultrices gravida. Elit at imperdiet dui accumsan sit amet nulla. Ut aliquam purus sit amet luctus venenatis
        lectus magna. Non consectetur a erat nam at lectus urna duis. Faucibus ornare suspendisse sed nisi lacus sed
        viverra tellus. Venenatis tellus in metus vulputate eu scelerisque felis imperdiet. Ornare aenean euismod
        elementum nisi quis eleifend.

        Sed turpis tincidunt id aliquet risus feugiat in ante. Eget nunc scelerisque viverra mauris in aliquam sem
        fringilla ut. Amet massa vitae tortor condimentum lacinia quis vel eros donec. At tempor commodo ullamcorper a
        lacus vestibulum. Curabitur gravida arcu ac tortor dignissim. Eget mauris pharetra et ultrices. Vitae purus
        faucibus ornare suspendisse sed nisi lacus sed. At elementum eu facilisis sed odio morbi quis commodo. Sed arcu
        non odio euismod lacinia at. Orci a scelerisque purus semper. Egestas sed sed risus pretium quam vulputate
        dignissim. Id venenatis a condimentum vitae sapien pellentesque habitant morbi tristique. Vestibulum lorem sed
        risus ultricies tristique nulla aliquet. Fermentum leo vel orci porta non pulvinar neque. Magna etiam tempor
        orci eu lobortis elementum nibh tellus. Dui faucibus in ornare quam viverra orci sagittis. Porttitor leo a diam
        sollicitudin tempor id eu nisl nunc. Elit pellentesque habitant morbi tristique.

        Nec dui nunc mattis enim ut tellus elementum. Nascetur ridiculus mus mauris vitae ultricies leo integer
        malesuada. Amet porttitor eget dolor morbi non. Viverra mauris in aliquam sem fringilla ut. Sollicitudin ac orci
        phasellus egestas tellus rutrum tellus. Ipsum suspendisse ultrices gravida dictum fusce ut placerat orci. Nulla
        facilisi nullam vehicula ipsum. Magna fringilla urna porttitor rhoncus dolor. Blandit turpis cursus in hac
        habitasse platea dictumst quisque. Sed arcu non odio euismod lacinia at quis. Ornare arcu dui vivamus arcu felis
        bibendum ut tristique. Imperdiet nulla malesuada pellentesque elit. Eget lorem dolor sed viverra. Massa enim nec
        dui nunc. Condimentum id venenatis a condimentum vitae sapien.

        Ut enim blandit volutpat maecenas volutpat blandit aliquam. Orci eu lobortis elementum nibh tellus molestie.
        Vestibulum sed arcu non odio euismod lacinia at quis. Ut diam quam nulla porttitor. Morbi tristique senectus et
        netus. Justo donec enim diam vulputate ut. Fusce ut placerat orci nulla pellentesque dignissim enim. Eget est
        lorem ipsum dolor sit amet consectetur adipiscing. Ut porttitor leo a diam sollicitudin tempor id eu nisl.
        Egestas maecenas pharetra convallis posuere morbi leo urna molestie. Volutpat ac tincidunt vitae semper quis.
        Massa tincidunt dui ut ornare lectus sit amet est. Nam at lectus urna duis convallis. Ornare massa eget egestas
        purus viverra accumsan in nisl. Sit amet nulla facilisi morbi. Elit pellentesque habitant morbi tristique
        senectus et netus. Duis tristique sollicitudin nibh sit amet commodo. Sed arcu non odio euismod lacinia.

        Dignissim suspendisse in est ante in nibh. Gravida quis blandit turpis cursus in. Feugiat sed lectus vestibulum
        mattis ullamcorper velit sed. Adipiscing elit pellentesque habitant morbi tristique senectus et netus et. Vitae
        sapien pellentesque habitant morbi tristique senectus. Turpis massa tincidunt dui ut ornare. Nunc lobortis
        mattis aliquam faucibus. Sollicitudin ac orci phasellus egestas tellus. Aliquet nec ullamcorper sit amet risus
        nullam eget felis. Ornare quam viverra orci sagittis. Pellentesque habitant morbi tristique senectus et netus et
        malesuada fames. Tortor aliquam nulla facilisi cras fermentum odio eu feugiat. Lacus viverra vitae congue eu
        consequat ac felis donec et. Ipsum consequat nisl vel pretium.</p> -->
    <script>
        function spr() {
            wpm = localStorage.getItem('4f:04:82:7d:31:02') || 200;
            let gtimeout = 0;
            let inner;
            let outer;
            let pgb;
            let pb;
            let wpmCounter;
            let timect;
            let play = false;
            let getText = () => ["--3--", "--2--", "--1--"].concat(Array.prototype.slice.call(document
                    .getElementsByClassName(
                        "sprtxt")).map(r => (r.href) ? r.innerHTML + "&!$!&" + r.href : r.innerHTML).join(" ")
                .split(" ")).reverse();
            let tCalc = () => term.reduce((tmp, i) => tmp + (1000 / (parseInt(wpm) / 60)) * ((i.length / 5 - 1) * 0.5 +
                1), 0);
            let term = getText();
            console.log(term);
            let timeRem = timeTotal = tCalc();
            console.log(timeRem);
            let setWpm = (dif) => {
                if (parseInt(wpm) + dif >= 0) {
                    wpm = parseInt(wpm) + dif;
                    timeTotal = tCalc();
                    wpmCounter.value = wpm;
                    localStorage.setItem('4f:04:82:7d:31:02', wpm);
                }
            };
            let tgPause = () => {
                play = !play;
                if (play) nextWord(term);
            };
            let tosec = (ms) => {
                let s = ((ms % 60000) / 1000).toFixed(0);
                return Math.floor(ms / 60000) + ":" + (s < 10 ? '0' : '') + s;
            };
            //TODO:add drag location selector
            (() => {
                var node = document.querySelector(".sprFocus");
                node.innerHTML = "";
                outer = document.querySelector(".sprFocus").appendChild(document.createElement('div'));
                inner = outer.appendChild(document.createElement('div'));
                outer.style.cssText =
                    "position: fixed; top: calc(50% - 50px); margin: auto; height: 100px; min-width: 800px; background: rgb(245, 245, 245) none repeat scroll 0% 0%; left: calc(50% - 400px); font-size: 70px; text-align: center; line-height: 100px; flex-direction: row; justify-content: center; align-items: center; display: flex; border-top: 3px solid; border-bottom: 3px solid; opacity: 0.97;";
                let temp = outer.appendChild(document.createElement('div'));
                temp.style.cssText =
                    "width: 3px; background: black none repeat scroll 0% 0%; height: 7px; position: absolute; top: 0px; left: 50%;";
                pgb = outer.appendChild(document.createElement('div'));
                pgb.style.cssText =
                    "width: 800px; background: red none repeat scroll 0% 0%; height: 4px; position: absolute; bottom: 0px;";
                temp = outer.appendChild(document.createElement('div'));
                19450
                temp.style.cssText =
                    "width: 3px; background: black none repeat scroll 0% 0%; height: 7px; position: absolute; bottom: 0px; left: 50%;";
                let temp1 = outer.appendChild(document.createElement('div'));
                temp1.style.cssText =
                    "position: absolute; left: 10px; flex-direction: row; display: flex; align-items: center; top: 5px;";
                temp = temp1.appendChild(document.createElement('button'));
                temp.style.cssText =
                    "background: rgb(238, 238, 238) none repeat scroll 0% 0%; color: black; border: medium none; font-size: 10px;";
                temp.innerHTML = '-';
                temp.addEventListener('click', () => setWpm(-10));
                wpmCounter = temp1.appendChild(document.createElement('input'));
                wpmCounter.type = "text";
                wpmCounter.size = "2";
                wpmCounter.style.cssText =
                    "font-size: 10px; line-height: 10px; height: 10px; margin: 10px;";
                wpmCounter.value = wpm;
                wpmCounter.addEventListener('input', () => wpm = wpmCounter.value);
                temp = temp1.appendChild(document.createElement('button'));
                temp.style.cssText =
                    "background: rgb(238, 238, 238) none repeat scroll 0% 0%; color: black; border: medium none; font-size: 10px;";
                temp.innerHTML = '+';
                temp.addEventListener('click', () => setWpm(10));
                temp1 = outer.appendChild(document.createElement('div'));
                temp1.style.cssText =
                    "position: absolute; right: 10px; flex-direction: row; display: flex; align-items: center; top: 5px;";
                pb = temp1.appendChild(document.createElement('button'));
                pb.style.cssText =
                    "background: rgb(230, 0, 0) none repeat scroll 0% 0%; color: black; border: medium none; font-size: 10px;height:20px;";
                pb.innerHTML = '&#9199;';
                pb.addEventListener('click', () => tgPause());
                temp = temp1.appendChild(document.createElement('button'));
                temp.style.cssText =
                    "background: rgb(230, 0, 0) none repeat scroll 0% 0%; color: black; border: medium none; border-left: 1px solid black; font-size: 10px;height:20px;";
                temp.innerHTML = '	&#8635;';
                temp.addEventListener('click', () => {
                    term = getText();
                    nextWord(term);
                });
                timect = outer.appendChild(document.createElement('div'));
                timect.style.cssText =
                    "position: absolute; right: 10px; flex-direction: row; display: flex; align-items: center; bottom: 5px;font-size: 10px;height:15px;";
                timect.innerHTML = tosec(timeTotal - timeRem) + "/" + tosec(timeTotal);
                inner.style.cssText = "display: inline-block; transform: translate(8%);";
                inner.innerHTML = 'Press play';
            })();
            let nextWord = (words) => {
                if (play) {
                    let next = words.pop();
                    if (next.length < 3 && words.length && words[words.length - 1].length < 6) {
                        next += ' ' + words.pop();
                    }
                    if (next.indexOf('&!$!&') !== -1) {
                        inner.innerHTML = "";
                        let tmp = inner.appendChild(document.createElement('a'));
                        let tmp2 = next.split("&!$!&");
                        console.log(tmp2);
                        tmp.innerHTML = tmp2[0];
                        tmp.href = tmp2[1];
                    } else inner.innerHTML = next;

                    let duration = (1000 / (wpm / 60)) * ((next.length / 5 - 1) * 0.5 + 1);
                    timeRem = tCalc();
                    pgb.style.width = 800 * ((timeTotal - timeRem) / timeTotal) + "px";
                    pgb.style.left = (timeTotal - timeRem) / timeTotal + "px";
                    timect.innerHTML = tosec(timeTotal - timeRem) + "/" + tosec(timeTotal);
                    let timeout = setTimeout(() => {
                        if (words.length) {
                            if (timeout !== gtimeout) {
                                return;
                            }
                            nextWord(words);
                        } else {
                            clearTimeout(gtimeout);
                        }
                    }, duration);
                    gtimeout = timeout;
                }
            };
        }
    </script>

</body>

</html>